---
# Preamble

## Author
author:
  name: Перфилов Александр Константинович | группа НПИбд 03-24
  affiliation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
   
## Title
title: "Лабораторная работа №9"
subtitle: "Управление SELinux    "
license: "CC BY"
## Generic options
lang: ru-RU
number-sections: true
toc: true
toc-title: "Содержание"
toc-depth: 2
## Crossref customization
crossref:
  lof-title: "Список иллюстраций"
  lot-title: "Список таблиц"
  lol-title: "Листинги"
## Bibliography
bibliography:
  - bib/cite.bib
csl: _resources/csl/gost-r-7-0-5-2008-numeric.csl
## Formats
format:
### Pdf output format
  pdf:
    toc: true
    number-sections: true
    colorlinks: false
    toc-depth: 2
    lof: true # List of figures
    lot: true # List of tables
#### Document
    documentclass: scrreprt
    papersize: a4
    fontsize: 12pt
    linestretch: 1.5
#### Language
    babel-lang: russian
    babel-otherlangs: english
#### Biblatex
    cite-method: biblatex
    biblio-style: gost-numeric
    biblatexoptions:
      - backend=biber
      - langhook=extras
      - autolang=other*
#### Misc options
    csquotes: true
    indent: true
    header-includes: |
      \usepackage{indentfirst}
      \usepackage{float}
      \floatplacement{figure}{H}
      \usepackage[math,RM={Scale=0.94},SS={Scale=0.94},SScon={Scale=0.94},TT={Scale=MatchLowercase,FakeStretch=0.9},DefaultFeatures={Ligatures=Common}]{plex-otf}
### Docx output format
  docx:
    toc: true
    number-sections: true
    toc-depth: 2
---
## Цель работы:
Целью данной работы является получение навыков работы с контекстом безопасности и политиками SELinux.

## Выполнение работы:

### Управление режимами SELinux:
Запустим терминал и получим полномочия администратора:
![](image/1.jpg){#fig:008 width=70%}
## Просмотрим текущую информацию о состоянии SELinux:
![](image/2.jpg){#fig:008 width=70%}

## Посмотрим, в каком режиме работает SELinux:
`![](image/3.jpg){#fig:008 width=70%}
## Изменим режим работы SELinux на разрешающий:
![](image/4.jpg){#fig:008 width=70%}
## Откроем файл `/etc/sysconfig/selinux` в текстовом редакторе:
![](image/5.jpg){#fig:008 width=70%}
_Рис. 2. Просмотр режима работы SELinux, изменение режима работы и проверка, открытие файла в текстовом редакторе._

# В открытом файле установим:
![](image/6.jpg){#fig:008 width=70%}
## Сохраним изменения и перезагрузим систему:
![](image/7.jpg){#fig:008 width=70%}
_Рис.3. Установка в файле SELINUX=disabled, сохранение изменений и перезагрузка системы._

## После перезагрузки проверим статус SELinux:
![](image/8.jpg){#fig:008 width=70%}
## Попробуем переключить режим работы:
![](image/9.jpg){#fig:008 width=70%}
## Система сообщает, что SELinux отключён. Откроем файл `/etc/sysconfig/selinux` и установим:
![](image/10.jpg){#fig:008 width=70%}
Сохраним изменения и перезагрузим систему.

### Использование restorecon для восстановления контекста безопасности:

## Просмотрим контекст безопасности файла `/etc/hosts`:
![](image/11.jpg){#fig:008 width=70%}
## Скопируем файл в домашний каталог и проверим контекст:
![](image/12.jpg){#fig:008 width=70%}
## Переместим файл обратно в `/etc` и снова проверим контекст:
![](image/13.jpg){#fig:008 width=70%}
## Восстановим контекст безопасности:
![](image/14.jpg){#fig:008 width=70%}
## Для массового исправления контекста выполним:
![](image/15.jpg){#fig:008 width=70%}


### Настройка контекста безопасности для нестандартного расположения файлов веб-сервера:

## Установим необходимое ПО:
![](image/16.jpg){#fig:008 width=70%}
## Создадим каталог и файл:
![](image/17.jpg){#fig:008 width=70%}
## Откроем файл и добавим текст:
![](image/18.jpg){#fig:008 width=70%}
Изменим файл конфигурации Apache `/etc/httpd/conf/httpd.conf`, заменив `DocumentRoot "/var/www/html"` на `DocumentRoot "/web"`. Также обновим настройки доступа.

## Запустим веб-сервер:
![](image/18.jpg){#fig:008 width=70%}
## Откроем веб-страницу в браузере:
![](image/19.jpg){#fig:008 width=70%}
## Применим новую метку контекста и восстановим контекст безопасности:
![](image/20.jpg){#fig:008 width=70%}
_Рис. 19. Настройка контекста безопасности для веб-сервера._

### Работа с переключателями SELinux:

Просмотрим список переключателей SELinux для службы ftp.Изменим значение переключателя.Изменим постоянное значение переключателя:
![](image/21.jpg){#fig:008 width=70%}

---

## Ответы на контрольные вопросы:
1. `setenforce 0`
2. `getsebool -a`
3. `audit2allow`
4. ```bash
semanage fcontext -a -t httpd_sys_content_t "/web(/.*)?"
restorecon -R -v /web
    ```
5. `/etc/sysconfig/selinux`
6. `/var/log/audit/audit.log`
7. `getsebool -a | grep ftp`
8. `ps -eZ` или `id -Z`

---

## Вывод:
В ходе выполнения лабораторной работы были получены навыки работы с контекстом безопасности и политиками 
