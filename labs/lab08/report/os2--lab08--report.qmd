---
# Preamble

## Author
author:
  name: Перфилов Александр Константинович | группа НПИбд 03-24
  affiliation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
   
## Title
title: "Лабораторная работа №8"
subtitle: "Управление событиями "
license: "CC BY"
## Generic options
lang: ru-RU
number-sections: true
toc: true
toc-title: "Содержание"
toc-depth: 2
## Crossref customization
crossref:
  lof-title: "Список иллюстраций"
  lot-title: "Список таблиц"
  lol-title: "Листинги"
## Bibliography
bibliography:
  - bib/cite.bib
csl: _resources/csl/gost-r-7-0-5-2008-numeric.csl
## Formats
format:
### Pdf output format
  pdf:
    toc: true
    number-sections: true
    colorlinks: false
    toc-depth: 2
    lof: true # List of figures
    lot: true # List of tables
#### Document
    documentclass: scrreprt
    papersize: a4
    fontsize: 12pt
    linestretch: 1.5
#### Language
    babel-lang: russian
    babel-otherlangs: english
#### Biblatex
    cite-method: biblatex
    biblio-style: gost-numeric
    biblatexoptions:
      - backend=biber
      - langhook=extras
      - autolang=other*
#### Misc options
    csquotes: true
    indent: true
    header-includes: |
      \usepackage{indentfirst}
      \usepackage{float}
      \floatplacement{figure}{H}
      \usepackage[math,RM={Scale=0.94},SS={Scale=0.94},SScon={Scale=0.94},TT={Scale=MatchLowercase,FakeStretch=0.9},DefaultFeatures={Ligatures=Common}]{plex-otf}
### Docx output format
  docx:
    toc: true
    number-sections: true
    toc-depth: 2
---
# Цель работы

Целью данной работы является получение навыков работы с планировщиками событий cron и at.

# Задание

1. Выполните задания по планированию задач с помощью crond (см. раздел 8.4.1).
2. Выполните задания по планированию задач с помощью atd (см. раздел 8.4.2).

# Выполнение лабораторной работы

## Планирование задач с помощью cron

Запустим терминал и получим полномочия администратора: su -. Просмотрим статус демона crond: systemctl status crond -l и содержимое файла конфигурации /etc/crontab: cat /etc/crontab (рис. [-@fig:001]).

![Запуск терминала и получение полномочий администратора, просмотр статуса демона crond и содержимого файла конфигурации /etc/crontab.](image/1.PNG){#fig:001 width=70%}

Теперь просмотрим список заданий в расписании: crontab -l. Ничего не отобразилось, так как расписание ещё не задано. Далее откроем файл расписания на редактирование: crontab -e (рис. [-@fig:002]).

![Просмотр списка заданий в расписании, открытие файла расписания на редактирование.](image/2.PNG){#fig:002 width=70%}

Предыдущая команда запустила интерфейс редактора (по умолчанию используется vi). Добавим следующую строку в файл расписания (запись сообщения в системный журнал), используя Ins для перехода в vi в режим ввода: */1 * * * * logger This message is written from root cron. Закроем сеанс редактирования vi и сохраним изменения, используя команду vi: Esc : wq. (рис. [-@fig:003]).

![Открытие текстового редактора vi и добавление строки в файл расписания.](image/3.PNG){#fig:003 width=70%}

Давайте разберём синтаксис этой записи: 
 
1. */1 - Запуск задания каждую минуту. Частота определяется первой звездочкой: */1 означает "каждую минуту". Часто вместо */1 можно увидеть просто *, так как каждую минуту является условием по умолчанию. 
2. ****  - Упоминание отдельных звездочек говорит о том, что задание будет выполняться каждую минуту каждого часа, дня, месяца, и дня недели, поскольку второе, третье, четвертое и пятое поля - это день месяца, месяц и день недели, соответственно. 
3. logger - Команда, которая будет выполняться каждый раз, когда cron запускает задачу. В данном случае это команда logger. 
4. This message is written from root cron - Сообщение, отправляемое командой logger в системный журнал. 
 
Таким образом, эта запись установит задачу, которая будет каждые 60 секунд записывать сообщение "This message is written from root cron" в системный журнал вашего компьютера.

Просмотрим список заданий в расписании: crontab -l (в расписании появилась запись о запланированном событии). Не выключая систему, через некоторое время (2–3 минуты) просмотрим журнал системных событий: grep written /var/log/messages (рис. [-@fig:004]).

![Просмотр списка заданий в расписании, просмотр журнала системных событий.](image/4.PNG){#fig:004 width=70%}

Вернёмся в текстовый редактор vi и изменим запись в расписании crontab на следующую: 0 */1 * * 1-5 logger This message is written from root cron (рис. [-@fig:005]).

![Изменение записи в расписании crontab.](image/5.PNG){#fig:005 width=70%}

Синтаксис записи в crontab: 
 
1. 0 */1 * * 1-5 -  это шаблон запуска задачи.  Он состоит из пяти полей, разделенных пробелами: 
2. * 0 - Минута. Задача будет запускаться в 0-ю минуту каждого часа. 
3. * */1 - Час. Звездочка (*) означает "каждый", /1  означает "каждый час". 
4. * - День месяца. Звездочка означает "каждый день месяца". 
5. * - Месяц. Звездочка означает "каждый месяц". 
6. 1-5 - День недели.  Диапазон 1-5 означает "с понедельника по пятницу". 
7. logger This message is written from root cron -  Это команда, которая будет выполняться по расписанию. В данном случае команда logger записывает сообщение в системный журнал (syslog). 
 
В итоге, данная запись crontab означает: "Каждую минуту, начиная с 0-ой минуты каждого часа, с понедельника по пятницу, запускать команду logger с сообщением This message is written from root cron".

Теперь просмотрим список заданий в расписании: crontab -l (рис. [-@fig:006]).

![Просмотр списка заданий в расписании.](image/6.PNG){#fig:006 width=70%}

Перейдём в каталог /etc/cron.hourly и создадим в нём файл сценария с именем eachhour (рис. [-@fig:007]).

![Открытие каталога /etc/cron.hourly и создание в нём файла сценария с именем eachhour.](image/7.PNG){#fig:007 width=70%}

Далее откроем файл eachhour для редактирования и пропишем в нём следующий скрипт (запись сообщения в системный журнал) (рис. [-@fig:008]).

![Открытие файла eachhour для редактирования и прописывание в нём скрипта.](image/8.PNG){#fig:008 width=70%}

Сделаем файл сценария eachhour исполняемым. Теперь перейдём в каталог /etc/crond.d и создадим в нём файл с расписанием
eachhour (рис. [-@fig:009]).

![Делаем файл сценария eachhour исполняемым, открытие каталога /etc/crond.d и создание в нём файла с расписанием eachhour, открытие файла на редактирование.](image/9.PNG){#fig:009 width=70%}

Откроем этот файл для редактирования и поместим в него следующее содержимое (рис. [-@fig:010]).

![Добавление содержимого в файл и сохранение изменений.](image/10.PNG){#fig:010 width=70%}

Синтаксис записи в crontab: 
 
1. 11 * * * * -  это шаблон запуска задачи.  Он состоит из пяти полей, разделенных пробелами: 
2. 11 - Минута. Задача будет запускаться в 11-ю минуту каждого часа. 
3. * - Час. Звездочка означает "каждый час". 
4. * - День месяца. Звездочка означает "каждый день месяца". 
5. * - Месяц. Звездочка означает "каждый месяц". 
6. * - День недели. Звездочка означает "каждый день недели". 
7. root -  Это имя пользователя, от которого будет запускаться задание. В данном случае, задание будет запускаться от пользователя root. 
8. logger This message is written from /etc/cron.d -  Это команда, которая будет выполняться по расписанию. В данном случае команда logger записывает сообщение в системный журнал (syslog). 
 
В итоге, данная запись crontab означает: "Каждую минуту, начиная с 11-ой минуты каждого часа, запускать от имени пользователя root команду logger с сообщением This message is written from /etc/cron.d".

Не выключая систему, через некоторое время (2 часа) просмотрим журнал системных событий. По журналу видим, что запуск сценария eachhour в соответствии с заданным расписанием был осуществлён (рис. [-@fig:011]).

![Просмотр журнала системных событий через 2 часа.](image/11.PNG){#fig:011 width=70%}

## Планирование заданий с помощью at

Запустим терминал и получим полномочия администратора: su -. Проверим, что служба atd загружена и включена: systemctl status atd. Зададим выполнение команды logger message from at в 17:00. Для этого введём at 17:00, а затем logger message from at. Используем Ctrl + d, чтобы закрыть оболочку. Убедимся, что задание действительно запланировано: atq. С помощью команды grep from at /var/log/messages посмотрим, появилось ли соответствующее сообщение в лог- файле в указанное вами время (сообщение появилось) (рис. [-@fig:012]).

![Запуск терминала и получение полномочий администратора, проверка загрузки и включения службы atd, создание задачи выполнения команды logger message from at в 17:00, закрытие оболочки. Проверка планировки задачи и выполнения её в указанное время.](image/12.PNG){#fig:012 width=70%}

# Ответы на контрольные вопросы 

1. Как настроить задание cron, чтобы оно выполнялось раз в 2 недели? 00 00 1,15 * * logger task

2. Как настроить задание cron, чтобы оно выполнялось 1-го и 15-го числа каждого месяца в 2 часа ночи? 00 02 1,15 * * logger task

3. Как настроить задание cron, чтобы оно выполнялось каждые 2 минуты каждый день? */2 * * * * logger task

4. Как настроить задание cron, чтобы оно выполнялось 19 сентября ежегодно? * * 19 9 logger task

5. Как настроить задание cron, чтобы оно выполнялось каждый четверг сентября ежегодно? * * * * 4 logger task

6. Какая команда позволяет вам назначить задание cron для пользователя alice? Приведите подтверждающий пример. * * * * alice logger task

7. Как указать, что пользователю bob никогда не разрешено назначать задания через cron? Приведите подтверждающий пример. Записать его в /etc/cron.deny

8. Вам нужно убедиться, что задание выполняется каждый день, даже если сервер во время выполнения временно недоступен. Как это сделать? Найти задание в логах grep cron /var/log/messages 

9. Какая команда позволяет узнать, запланированы ли какие-либо задания на выполнение планировщиком atd? atq

# Выводы

В ходе выполнения лабораторной работы были получены навыки работы с планировщиками событий cron и at

